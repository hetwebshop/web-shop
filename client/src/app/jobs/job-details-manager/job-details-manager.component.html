<div fxLayout="row" fxLayoutAlign="center" style="margin-top: 100px;">
  <mat-card class="text-center" style="border: 1px solid #004D40;" fxFlex="70" fxFlex.lt-sm="90">
    <mat-card-title style="color:#004D40; height: 50px; align-items: center; display: flex; justify-content: center;">
      {{ isJobAd ? (isEditMode ? 'Uredi Oglas' : 'Kreiraj Oglas') : (isEditMode ? 'Uredi uslugu' : 'Kreiraj uslugu') }}
    </mat-card-title>
    <mat-divider style="background-color: #004D40;"></mat-divider>
        <mat-card-content>
      <form [formGroup]="form" style="margin-top: 50px;" (ngSubmit)="onSubmit()" #jobForm="ngForm" fxLayout="column" fxLayoutAlign="center">
        <input type="hidden" formControlName="id">
        <mat-slide-toggle color="primary" (change)="onToggleUseUserDataChange($event)" style="margin-bottom: 20px;">
          <span style="font-weight: bold;">Popuni podacima sa mog profila</span>
        </mat-slide-toggle>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tip oglasa</mat-label>
          <mat-select formControlName="advertisementTypeId" placeholder="Odaberite tip oglasa">
            <mat-option *ngFor="let adType of advertisementTypes" [value]="adType.id">{{ adType.name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-radio-group formControlName="adDuration"  class="duration-radio-group" appearance="outline">
          <mat-label style="font-weight: bold; margin-right: 20px;">Odaberite period trajanja oglasa:</mat-label>
          <mat-radio-button value="7" class="duration-radio-button">7 dana</mat-radio-button>
          <mat-radio-button value="15" class="duration-radio-button">15 dana</mat-radio-button>
          <mat-radio-button value="30" class="duration-radio-button">30 dana</mat-radio-button>
        </mat-radio-group>


        <!-- Details about user -->
        <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="16px" fxLayoutAlign="start center">
          <mat-form-field appearance="outline" fxFlex class="flex-item full-width">
            <mat-label>Ime</mat-label>
            <input matInput type="text" formControlName="applicantFirstName" placeholder="Unesite ime" required />
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex class="flex-item full-width">
            <mat-label>Prezime</mat-label>
            <input matInput type="text" formControlName="applicantLastName" placeholder="Unesite prezime" required />
          </mat-form-field>
        </div>
        
        <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="16px" fxLayoutAlign="start center">
          <mat-form-field appearance="outline" fxFlex class="flex-item full-width">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="applicantEmail" placeholder="Unesite email" required />
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex class="flex-item full-width">
            <mat-label>Broj telefona</mat-label>
            <input matInput type="tel" formControlName="applicantPhoneNumber" placeholder="Unesite broj telefona" required />
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Spol</mat-label>
          <mat-select formControlName="applicantGender" placeholder="Odaberite spol">
            <mat-option *ngFor="let gender of genders" [value]="gender">{{ genderName(gender) }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Datum rođenja</mat-label>
          <input matInput [matDatepicker]="dobPicker" formControlName="applicantDateOfBirth">
          <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
          <mat-datepicker #dobPicker></mat-datepicker>
        </mat-form-field>
        
        <div formArrayName="applicantEducations">
          <div *ngFor="let education of applicantEducations.controls; let i = index" [formGroupName]="i" class="education-group">
            <h3>Obrazovanje {{ i + 1 }}</h3>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Univerzitet</mat-label>
              <input matInput type="text" formControlName="university" placeholder="Unesite univerzitet" required>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Fakultet</mat-label>
              <input matInput type="text" formControlName="institutionName" placeholder="Unesite fakultet" required>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Odsjek</mat-label>
              <input matInput type="text" formControlName="fieldOfStudy" placeholder="Unesite odsjek" required>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Zvanje</mat-label>
              <input matInput type="text" formControlName="degree" placeholder="Unesite zvanje" required>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Godina početka studija</mat-label>
              <input matInput type="number" formControlName="educationStartYear" placeholder="Unesite godinu početka studija" required>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Godina kraja studija</mat-label>
              <input matInput type="number" formControlName="educationEndYear" placeholder="Unesite godinu kraja studija">
            </mat-form-field>
            <button mat-button type="button" color="warn" (click)="removeEducation(i)">Ukloni obrazovanje</button>
          </div>
        </div>
        <div>
          <button mat-stroked-button type="button" style="color:#004D40;margin-bottom: 25px; border-color: #004D40; max-width: 150px;" (click)="addEducation()">Dodaj obrazovanje</button>
        </div>
        
        <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="16px" fxLayoutAlign="start center">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Država</mat-label>
            <mat-select formControlName="countryId" placeholder="Odaberite državu" disabled>
              <mat-option *ngFor="let country of countries" [value]="country.id">{{ country.name }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Grad</mat-label>
            <mat-select formControlName="cityId" placeholder="Odaberite grad">
              <mat-option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Details about job and skills -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Pozicija</mat-label>
          <input matInput type="text" formControlName="position" placeholder="Unesite poziciju" required />
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Biografija</mat-label>
          <textarea matInput formControlName="biography" rows="4" placeholder="Unesite biografiju" required></textarea>
        </mat-form-field>

        <div fxFlex="95" fxFlex.lt-sm="90" appearance="outline" style="margin-bottom: 20px;">
          <!-- If there is no existing file, show file input -->
          <div *ngIf="!existingFilePath || !populateFormWithUserProfileData">
            <input type="file" (change)="onFileSelected($event)" accept="application/pdf" />
          </div>
        
          <!-- If there is an existing file, show file details and delete option -->
          <div *ngIf="existingFilePath && populateFormWithUserProfileData">
            <p>Existing file: <a [href]="existingFilePath" target="_blank">View file</a></p>
            <button mat-button (click)="deleteExistingFile()">Delete existing file</button>
          </div>
        
          <!-- Show selected file name if a new file is selected -->
          <div *ngIf="selectedFileName">
            Selected file: {{ selectedFileName }}
          </div>
        </div>

        <mat-form-field *ngIf="selectedAdvertisementType == AdvertisementTypeEnum.Service" appearance="outline" class="full-width">
          <mat-label>Cijena usluge</mat-label>
          <input matInput type="number" formControlName="price" placeholder="Unesite cijenu" />
        </mat-form-field>
        
        <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="16px" fxLayoutAlign="start stretch">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Kategorija posla</mat-label>
            <mat-select formControlName="jobCategoryId" (selectionChange)="onCategoryChange($event.value)">
              <mat-option *ngFor="let category of jobCategories" [value]="category.id">{{ category.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tip posla</mat-label>
          <mat-select formControlName="jobTypeId" placeholder="Odaberite tip posla">
            <mat-option *ngFor="let jobType of jobTypes" [value]="jobType.id">{{ jobType.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button style="background-color: #004D40; color: white;" type="submit">{{ isJobAd ? (isEditMode ? 'Uredi Oglas' : 'Kreiraj Oglas') : (isEditMode ? 'Uredi uslugu' : 'Kreiraj uslugu') }}</button>
      </form>
    </mat-card-content>
  </mat-card>
</div>
